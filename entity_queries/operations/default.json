{% for dataset in fixed_cardinality_datasets %}
{
  "name": "index-pod_fixed-cardinality-{{dataset}}",
  "operation-type": "bulk",
  "corpora" : "fixed-cardinality_{{dataset}}-docs",
  "bulk-size": {{bulk_size | default(5000)}},
  "detailed-results": {{detailed_results | default("false")}},
  "ingest-percentage": 100
},
{
  "name": "touch-pod-index_fixed-cardinality-{{dataset}}",
  "operation-type": "bulk",
  "corpora" : "fixed-cardinality_{{dataset}}-docs",
  "bulk-size": {{touch_bulk_size}},
  "ingest-percentage": 100,
  "pipeline": "timestamp_pipeline",
  "detailed-results": {{detailed_results | default("false")}}
},
{
  "name": "esql_single-source_limit-1000_fixed-cardinality-{{dataset}}_plaintext-filter_no-aggs",
  "operation-type": "esql",
  "detailed-results": {{detailed_results | default("false")}},
  "query": "FROM fixed-cardinality_{{dataset}}-docs | WHERE host.name::keyword IS NOT NULL | WHERE @timestamp >= \"2024-10-30T23:00:00.000Z\" AND @timestamp <= \"2024-10-30T23:05:00.000Z\" | STATS entity.last_seen_timestamp = MAX(@timestamp) BY host.name::keyword | RENAME `host.name::keyword` AS host.name | EVAL entity.type = \"host\", entity.id = host.name, entity.display_name = entity.id | SORT entity.last_seen_timestamp DESC | LIMIT 1000"
},
{
  "name": "esql_single-source_limit-1000_fixed-cardinality-{{dataset}}_plaintext-filter_top-3-aggs",
  "operation-type": "esql",
  "detailed-results": {{detailed_results | default("false")}},
  "query": "FROM fixed-cardinality_{{dataset}}-docs | WHERE host.name::keyword IS NOT NULL | WHERE @timestamp >= \"2024-10-30T23:00:00.000Z\" AND @timestamp <= \"2024-10-30T23:05:00.000Z\" | STATS agent.id = TOP(agent.id::keyword, 3, \"desc\"), kubernetes.pod.ip = TOP(kubernetes.pod.ip::keyword, 3, \"desc\"), entity.last_seen_timestamp = MAX(@timestamp) BY host.name::keyword | RENAME `host.name::keyword` AS host.name | EVAL entity.type = \"host\", entity.id = host.name, entity.display_name = entity.id | SORT entity.last_seen_timestamp DESC | LIMIT 1000"
},
{
  "name": "esql_single-source_limit-1000_fixed-cardinality-{{dataset}}_dsl-filter_no-aggs",
  "operation-type": "esql",
  "detailed-results": {{detailed_results | default("false")}},
  "query": "FROM fixed-cardinality_{{dataset}}-docs | STATS entity.last_seen_timestamp = MAX(@timestamp) BY host.name::keyword | RENAME `host.name::keyword` AS host.name | EVAL entity.type = \"host\", entity.id = host.name, entity.display_name = entity.id | SORT entity.last_seen_timestamp DESC | LIMIT 1000",
  "filter": {
    "bool": {
      "filter": [
        {
          "bool": {
            "should": [
              {
                "exists": {
                  "field": "host.name"
                }
              }
            ],
            "minimum_should_match": 1
          }
        },
        {
          "bool": {
            "filter": [
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "gte": "2024-10-30T23:00:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              },
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "lte": "2024-10-30T23:05:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              }
            ]
          }
        }
      ]
    }
  }
},
{
  "name": "esql_single-source_limit-1000_fixed-cardinality-{{dataset}}_dsl-filter_group-by_no-aggs",
  "operation-type": "esql",
  "detailed-results": {{detailed_results | default("false")}},
  "query": "FROM fixed-cardinality_{{dataset}}-docs | STATS @timestamp = MAX(@timestamp) by host.name::keyword | RENAME `host.name::keyword` AS host.name | STATS entity.last_seen_timestamp = MAX(@timestamp) BY host.name | EVAL entity.type = \"host\", entity.id = host.name, entity.display_name = entity.id | SORT entity.last_seen_timestamp DESC | LIMIT 1000",
  "filter": {
    "bool": {
      "filter": [
        {
          "bool": {
            "should": [
              {
                "exists": {
                  "field": "host.name"
                }
              }
            ],
            "minimum_should_match": 1
          }
        },
        {
          "bool": {
            "filter": [
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "gte": "2024-10-30T23:00:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              },
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "lte": "2024-10-30T23:05:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              }
            ]
          }
        }
      ]
    }
  }
},
{
  "name": "esql_single-source_limit-1000_fixed-cardinality-{{dataset}}_dsl-filter_top-3-aggs",
  "operation-type": "esql",
  "detailed-results": {{detailed_results | default("false")}},
  "query": "FROM fixed-cardinality_{{dataset}}-docs | STATS agent.id = TOP(agent.id::keyword, 3, \"desc\"), kubernetes.pod.ip = TOP(kubernetes.pod.ip::keyword, 3, \"desc\"), entity.last_seen_timestamp = MAX(@timestamp) BY host.name::keyword | RENAME `host.name::keyword` AS host.name | EVAL entity.type = \"host\", entity.id = host.name, entity.display_name = entity.id | SORT entity.last_seen_timestamp DESC | LIMIT 1000",
  "filter": {
    "bool": {
      "filter": [
        {
          "bool": {
            "should": [
              {
                "exists": {
                  "field": "host.name"
                }
              }
            ],
            "minimum_should_match": 1
          }
        },
        {
          "bool": {
            "filter": [
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "gte": "2024-10-30T23:00:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              },
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "lte": "2024-10-30T23:05:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              }
            ]
          }
        }
      ]
    }
  }
},
{
  "name": "esql_single-source_limit-1000_fixed-cardinality-{{dataset}}_dsl-filter_group-by_top-3-aggs",
  "operation-type": "esql",
  "detailed-results": {{detailed_results | default("false")}},
  "query": "FROM fixed-cardinality_{{dataset}}-docs | STATS @timestamp = MAX(@timestamp) BY host.name::keyword, agent.id::keyword, kubernetes.pod.ip::keyword | RENAME `host.name::keyword` AS host.name, `agent.id::keyword` AS agent.id, `kubernetes.pod.ip::keyword` AS kubernetes.pod.ip | STATS agent.id = TOP(agent.id, 3, \"desc\"), kubernetes.pod.ip = TOP(kubernetes.pod.ip, 3, \"desc\"), entity.last_seen_timestamp = MAX(@timestamp) BY host.name | EVAL entity.type = \"host\", entity.id = host.name, entity.display_name = entity.id | SORT entity.last_seen_timestamp DESC | LIMIT 1000",
  "filter": {
    "bool": {
      "filter": [
        {
          "bool": {
            "should": [
              {
                "exists": {
                  "field": "host.name"
                }
              }
            ],
            "minimum_should_match": 1
          }
        },
        {
          "bool": {
            "filter": [
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "gte": "2024-10-30T23:00:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              },
              {
                "bool": {
                  "should": [
                    {
                      "range": {
                        "@timestamp": {
                          "lte": "2024-10-30T23:05:00.000Z"
                        }
                      }
                    }
                  ],
                  "minimum_should_match": 1
                }
              }
            ]
          }
        }
      ]
    }
  }
}{{ ", " if not loop.last else "" }}
{%- endfor %}
