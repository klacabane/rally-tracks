{% for dataset in fixed_cardinality_datasets %}
{
  "name": "dsl_single-source_limit-1000_fixed-cardinality-{{dataset}}_terms_no-aggs",
  "operation-type": "search",
  "detailed-results": {{detailed_results | default("false")}},
  "data-stream": "fixed-cardinality_{{dataset}}-docs",
  "body": {
    {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "bool": {
                "should": [
                  {
                    "exists": {
                      "field": "host.name"
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            },
            {
              "bool": {
                "filter": [
                  {
                    "bool": {
                      "should": [
                        {
                          "range": {
                            "@timestamp": {
                              "gte": "2024-10-30T23:00:00.000Z",
                              "lte": "2024-10-30T23:05:00.000Z"
                            }
                          }
                        }
                      ],
                      "minimum_should_match": 1
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      "aggs": {
        "entities": {
          "terms": {
            "size": 1000,
            "field": "host.name",
            "order": { "last_seen_timestamp": "desc" }
          },
          "aggs": {
            "last_seen_timestamp": {
              "max": {
                "field": "@timestamp"
              }
            }
          }
        }
      }
    }
  }
},
{
  "name": "dsl_single-source_limit-1000_fixed-cardinality-{{dataset}}_terms_top-3-aggs",
  "operation-type": "search",
  "detailed-results": {{detailed_results | default("false")}},
  "data-stream": "fixed-cardinality_{{dataset}}-docs",
  "body": {
    {
      "size": 0,
      "query": {
        "bool": {
          "filter": [
            {
              "bool": {
                "should": [
                  {
                    "exists": {
                      "field": "host.name"
                    }
                  }
                ],
                "minimum_should_match": 1
              }
            },
            {
              "bool": {
                "filter": [
                  {
                    "bool": {
                      "should": [
                        {
                          "range": {
                            "@timestamp": {
                              "gte": "2024-10-30T23:00:00.000Z",
                              "lte": "2024-10-30T23:05:00.000Z"
                            }
                          }
                        }
                      ],
                      "minimum_should_match": 1
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      "aggs": {
        "entities": {
          "terms": {
            "size": 1000,
            "field": "host.name",
            "order": { "last_seen_timestamp": "desc" }
          },
          "aggs": {
            "last_seen_timestamp": {
              "max": {
                "field": "@timestamp"
              }
            },
            "agent.id": {
              "terms": {
                "field": "agent.id",
                "size": 3
              }
            },
            "kubernetes.pod.ip": {
              "terms": {
                "field": "kubernetes.pod.ip",
                "size": 3
              }
            }
          }
        }
      }
    }
  }
}{{ ", " if not loop.last else "" }}
{%- endfor %}
